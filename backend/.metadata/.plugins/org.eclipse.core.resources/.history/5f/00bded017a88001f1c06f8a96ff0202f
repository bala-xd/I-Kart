package com.service;

import java.util.Optional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.dto.CustomerDTO;
import com.dto.ProductDTO;
import com.model.Cart;
import com.model.CartItem;
import com.repo.ICartRepo;

@Service
public class CartService {

    @Autowired
    private ICartRepo repo;

    public Cart createCart(CustomerDTO cDto) {
    	Cart c = new Cart();
    	c.setCustomerName(cDto.getName());
    	c.setCartId(cDto.getUserId() + "c");
        return repo.save(c);
    }

    public Cart getCart(String cartId) {
        Optional<Cart> op = repo.findById(cartId);
        return op.orElse(null);
    }
    
    public Cart addItemtoCart(Cart cart, ProductDTO p, int qty) {
    	CartItem existingItem = cart.getItems().stream().filter(i -> i.getProductId()==p.getId()).findFirst().orElse(null);
    	System.out.println(existingItem);
    	
    	if (existingItem != null) {
            existingItem.setQuantity(existingItem.getQuantity() + qty);
        } else {
            CartItem newItem = new CartItem(p.getId(), p.getName(), qty);
            cart.addItem(newItem);
        }
    	
    	cart.setTotalPrice(qty*p.getPrice());
    	return repo.save(cart);
    }
}
